---
location: sales/pro/dedicated-server-config
id:  54c1c3f9f778fc1dd09be012
name: GCE-32525
comments: Update javascript with 2 skills to implement Pro-Active Chat for Hosting LP - Pro pages
configPage: true
sitecore: true 
cssVersionOverride: 1
---
{% extends 'layouts/config-base.html' %}

{% block steps %}
                        <form action="" method="get" id="configForm">
                            <div class="config-step medium-margin-top-step backup">
                                <h2>[@L[cds.sales/gd/pro/dedicated-server-config:Servermanagement]@L]</h2>
                                <p class="product-name ">[@L[cds.sales/gd/pro/dedicated-server-config:servertagline]@L]</p>
                                <p class="product-name ">[@L[cds.sales/gd/pro/dedicated-server-config:servertagline2]@L]</p>
                                <div class="config-product-wrapper config-product-ds" >
                                    <div>
                                        <ul class="product-options" id="managedOptions">
                                        </ul> 
                                    </div>
                                </div>
                                <!-- /End Product -->
                            </div>
                            <div class="config-step-box-shadow backup"></div>
                            <div data-ci="" class="config-step-break move backup" data-scroll=".box2">
                                <span class="icon-down"></span>
                            </div>

                            <div class="config-step medium-margin-top-step box2">
                                <h2>[@L[cds.sales/gd/pro/dedicated-server-config:TermsHeader]@L]</h2>
                                <p class="product-name orange-text">[@L[cds.sales/gd/pro/dedicated-server-config:termtagline]@L]</p>
                                <p class="product-name">[@L[cds.sales/gd/pro/dedicated-server-config:termtagline2]@L].</p>
                                <div class="config-product-wrapper config-product-ds">
                                    <div>
                                        <ul class="product-options" id="termOptions">
                                        </ul> 
                                    </div>
                                </div>
                                <!-- /End Product -->
                            </div>
                            <div class="config-step-box-shadow"></div>

                            <div class="config-continue-to-cart-wrapper">
                                <a data-ci="93500" id="continue-to-cart-button" class="btn btn-warning btn-lg js-addtocart box5"><span class="icon-shopping-cart"></span> [@L[cds.sales/gd/pro/dedicated-server-config:ctcart]@L]</a>
                            </div>
                            <input type="hidden" id="osAddon"  value="">
                            <input type="hidden" id="osAddonPrice"  value="">
                            <input type="hidden" id="isConfigUpdated"  value="0"> 
                        </form> 
{% endblock %}

{% block modals %}

{% endblock %} 

{% block footer %}
  <script src="[@T[link:<javascriptroot />]@T]fos/office365/js/currency-calc.v1.0.3.min.js" type="text/javascript"></script>
  <script>
    if(typeof currencyCalc != "undefined"){
      currencyCalc.base = "[@T[currencyprice:<price usdamount="1000000000" dropdecimal="false" dropsymbol="false" htmlsymbol="false" negative="parenthesis" />]@T]";
    }
  </script>
  <script>
      $(document).ready(function() {
        // if(document.referrer.toLowerCase().indexOf("/hosting/dedicated-servers")<=0)
        // {
        //     window.location.assign('[@T[link:<relative path="~/hosting/dedicated-servers.aspx"><param name="ci" value="90994"/></relative>]@T]');
        // }
        var plan = Config.getParameterByName('plan');
        Config.loadData(plan);

        if (typeof FastballEvent_MouseClick === 'function' && typeof fbiLibCheckQueue === 'function') {
                $('[data-ci]').click(function(e){
                    $this = $(this);
                    FastballEvent_MouseClick(e,$this.attr('data-ci'),$(this)[0],'a');
                    fbiLibCheckQueue();
                });
            }

        $('.move').scrollToSection();
        $(window).scroll(function() {
          updateOrderSummaryPosition();
        });
        $(window).resize(function() {
          updateOrderSummaryPosition();
        });
         updateOrderSummaryPosition();

        $('.js-addtocart').on('click',function (e){
            e.preventDefault();
            $(this).unbind('click');
            var $this = $(this);
            var ci = $this.attr('data-ci');
            var itccode = $("#isConfigUpdated").val() === "0" 
                        ? $('#osAddon').val().split('_')[3] == 'linux' ? 'pro_Ded_Linux':'pro_Ded_Windows'
                        :$('#osAddon').val().split('_')[3] == 'linux' ? 'pro_Ded_Linux_config':'pro_Ded_Windows_config';
            var qty = '1';
            var packageId = $('input:radio[name="termOption"]:checked').val();;
            var addons = Config.generateAddonsURL();

            ##if(isManager())
            var managerId= Config.getParameterByName('mgrshopper');
            ##endif
            //update package with add on if package is already added
            var apiEndpoint = '[@T[link:<relative path="api/package/{0}/{1}/{2}/{3}/{4}" parammode="explicit"/>]@T]'.replace('{0}','update').replace('{1}',itccode).replace('{2}',ci).replace('{3}',qty).replace('{4}',packageId);
            
            apiEndpoint =apiEndpoint +addons;
            ##if(isManager())
              apiEndpoint +='&mgrshopper='+ managerId;
            ##endif
            $.ajax({
                  type: 'POST',
                  url: apiEndpoint,
                  complete: function (data) {
                      var response = $.parseJSON(data.responseText);
                      if (response.Success) {
                        ##if(isManager())
                        window.location = '[@T[link:<external linktype="MANAGERCARTURL" path="/basket.aspx" ><param name="pro" value="1" /></external>]@T]';
                        ##else
                        window.location = '[@T[link:<external linktype="carturl" path="/basket.aspx" ><param name="pro" value="1" /></external>]@T]';
                        ##endif
                      }
                      else
                      {
                        ##if(isManager())
                        window.location = '[@T[link:<external linktype="MANAGERCARTURL" path="/basket.aspx" ><param name="pro" value="1" /></external>]@T]';
                        ##else
                        window.location = '[@T[link:<external linktype="carturl" path="/basket.aspx" ><param name="pro" value="1" /></external>]@T]';
                        ##endif
                      } 
                  },
                  dataType: 'json'
            });
      });
    

        function updateOrderSummaryPosition() {

          var paddingTop = 20/* for prettiness when scrolling */,
            $configCartWrapper = $('.config-cart-wrapper'),
            scrollTop = $(window).scrollTop(),
            scrollLeft = $(window).scrollLeft(),
            topStep1 = $("div.config-step:visible:first").offset().top,
            topOfWindowAboveTopOfStep1 = (scrollTop <= (topStep1 - paddingTop)),
            $footer = $('.scroll-down-wrapper');

            $footer.css('visibility','visible');
            $configCartWrapper.css({'top':'0px','position':'static'});

          if(!topOfWindowAboveTopOfStep1) {
            // keep the top of the summary at 0
            
          //} else {
            //check for if summary can fit without going below the bottom of the last step
            
            var proposedNewTop = scrollTop - (topStep1 - paddingTop),

              proposedNewBottom = proposedNewTop + $configCartWrapper.height(),
              $lastStep = $("div.config-step:last"),
              bottomOfLastStep = $lastStep.offset().top + $lastStep.height() - topStep1,
              canFit = (proposedNewBottom <= bottomOfLastStep);

            if(scrollTop>=(topStep1-paddingTop) && ((scrollTop+$configCartWrapper.height())<=$lastStep.offset().top + $lastStep.height() + paddingTop) ){
              try{
                var configCartWrapperLeft = $configCartWrapper.offset().left;
                $configCartWrapper.css({'top':'20px','position':'fixed','width':$configCartWrapper.innerWidth(),'left':(configCartWrapperLeft - scrollLeft) +'px'});
              }catch(err){
                //if errors don't float the $confiCartWrapper
                $configCartWrapper.css({'top':'0px','position':'static'});
              }
              if((scrollTop+paddingTop)>=$lastStep.offset().top){
                $footer.css('visibility','hidden');
              }else{
                $footer.css('visibility','visible');
              }
            } else {
              try{
                var configCartWrapperLeft = $configCartWrapper.offset().left;
                $configCartWrapper.css({'position':'fixed','width':$configCartWrapper.innerWidth(),'left':(configCartWrapperLeft - scrollLeft) +'px'});
              }catch(err){
                //if errors don't float the $confiCartWrapper
                $configCartWrapper.css({'top':'0px','position':'static'});

              }
              // affix the summary so the bottom lines up with the bottom of the last step
              $footer.css('visibility','hidden');
              var topForBottomAligned = ($lastStep.offset().top + $lastStep.height() +$footer.height()) - (scrollTop + $configCartWrapper.height() );
              //topForBottomAligned = bottomOfLastStep - $configCartWrapper.height() + paddingTop;
              $configCartWrapper
                .css({'top': topForBottomAligned + 'px'});
            }
          }
          
        }

      });

      var Config = {
        loadData: function(plan){
          
          if(plan.indexOf('pro') == -1){
              getMappedPlan(plan);
            }
          var defaultPackageId=plan; 
          var packageName = plan.substr(0, plan.lastIndexOf('_'));
          
          var url = '[@T[link:<relative path="~/api/package/config/{0}"/>]@T]';
          url =url.replace('{0}',packageName);

          $.getJSON(url).success(function (data){
              processConfigData(data,defaultPackageId);
              Config.buildProductOrder(data);
          });
        },
        getParameterByName: function(name){
          name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
          var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
              results = regex.exec(location.search);
          return  decodeURIComponent(results[1].replace(/\+/g, " "));
        },
        refreshCart: function(){
          var termOption =$('input:radio[name="termOption"]').filter(':checked');
          var managedOption =$('input:radio[name="managedOption"]').filter(':checked');
          var term = termOption.data('term');
          var monthString = (term > 1) ? " [@L[cds.sales/gd/pro/dedicated-server-config:months]@L]" : " [@L[cds.sales/gd/pro/dedicated-server-config:month]@L]";
          var managedPrice = managedOption.data('price');
          var managedName = managedOption.data('name');
          
          Config.updateProductPrice(currencyCalc.stripFormat(managedPrice));
          
          var termPrice = termOption.attr('data-price');
          
          var planPrice = '0';

          planPrice= currencyCalc.evaluate([term,"*",termPrice]);

          $('#summaryAddon').html(managedName);
          $('#summaryTerm').html(term + monthString);
          $('.currency-amount').html(planPrice);


          $('#addonPrice').html(termOption.attr('data-price')+'[@L[cds.sales/gd/pro/managed-vps-config:mo]@L]');
        },
        refreshManagedPrices: function(){
          var selectedAddonPrice = $('input:radio[name="managedOption"]').filter(':checked').data('price');
          var selectedAddonValue = currencyCalc.stripFormat(selectedAddonPrice);
          var addonValue = 0;

          $('input:radio[name="managedOption"]').filter(':checked').parent().find('.price-container').html('<span class="orange-text"> [@L[cds.sales/gd/pro/dedicated-server-config:included]@L]</span>');

          $('input:radio[name="managedOption"]').not(':checked').each(function (){
            addonValue= currencyCalc.stripFormat($(this).data('price'));
             if (parseFloat(addonValue)>parseFloat(selectedAddonValue)){
              $(this).parent().find('.price-container').html('<span class="orange-text"> [@L[cds.sales/gd/pro/dedicated-server-config:add]@L] '+ currencyCalc.evaluate([$(this).data('price'),"-",selectedAddonPrice]) +'[@L[cds.sales/gd/pro/dedicated-server-config:mo]@L]</span>');
            }else{
              $(this).parent().find('.price-container').html('<span class="product-desc"> [@L[cds.sales/gd/pro/dedicated-server-config:subtract]@L] '+ currencyCalc.evaluate([selectedAddonPrice,"-",$(this).data('price')]) +'[@L[cds.sales/gd/pro/dedicated-server-config:mo]@L]</span>');
            }
          });
          Config.updateProductPrice(selectedAddonPrice);
        },
        updateProductPrice : function(managedAddonPrice){
          var osAddonPrice = currencyCalc.stripFormat($('#osAddonPrice').val());


          $("#termOptions").find("input[type=radio]").each(function(){
            var term = $(this);
            var totalAddonPrice = currencyCalc.evaluate([osAddonPrice,"+",managedAddonPrice]); 
            var totalAddonPrice = getAddOnDiscount(term.data('discount'),totalAddonPrice);

            var totalPrice = currencyCalc.evaluate([totalAddonPrice,"+",currencyCalc.stripFormat(term.data('price'))]); 
            term.attr('data-price',totalPrice);
            term.parent().find('.price').text(totalPrice+'[@L[fosconfigcommon:permonth]@L]');

          });

          var oneMonthPrice = $("#termOptions").find("input[type=radio]").first().attr('data-price');

          $("#termOptions").find("input[type=radio]").each(function(){
            var secondaryPrice = $(this).attr('data-price');
            var percent = getPercentage(oneMonthPrice,secondaryPrice);
            if(percent > 0){
               var savingsString = " - [@L[fosconfigcommon:save]@L]&nbsp;" + percent + '%' ;
               var strikeString=  "<span class='product-desc'> - <strike>" + oneMonthPrice + "</strike>[@L[fosconfigcommon:permonth]@L]</span>" ;
               $(this).parent().find('.price').append(savingsString + strikeString);
            }
          });
        },
        buildProductOrder: function(data){
          var term = $('input:radio[name="termOption"]').filter(':checked').data('term');
          var addon = $('input:radio[name="managedOption"]').filter(':checked').data('price');
          var monthString = (term > 1) ? "[@L[cds.sales/gd/pro/dedicated-server-config:months]@L]" : "[@L[cds.sales/gd/pro/dedicated-server-config:month]@L]";

          var planRAM = data.details.ram;
          var planStorage = data.details.storage;
          var planBandwidth = data.details.bandwidth;

          $('#summaryRAM').html('<span class="summary-features">'+ planRAM +'</span>' + ' [@L[cds.sales/gd/pro/dedicated-server-config:RAM]@L]');
          $('#summaryStorage').html('<span class="summary-features">'+planStorage +'</span>' + ' [@L[cds.sales/gd/pro/dedicated-server-config:Storage]@L]');
          $('#summaryBandwidth').html('<span class="summary-features">'+planBandwidth +'</span>' + ' [@L[cds.sales/gd/pro/dedicated-server-config:Bandwidth]@L]');
        },
        init: function (){
          
          Config.refreshCart();

          $('input:radio').change(function(){
            Config.refreshCart();
            $('#isConfigUpdated').val('1');

          }); 

          $('input[name=managedOption]').change(function(){
            Config.refreshManagedPrices();
            $('#isConfigUpdated').val('1');
          }); 

          $('.isToolTip').tooltip();
        },
        generateAddonsURL: function() {
            var addonURL = '';
            var managedOption = $('input:radio[name="managedOption"]:checked');
            var managedPrice = managedOption.data('price');
            var osOption = $('#osAddon').val();
            addonURL += '?addons=' + osOption + "-1";
            if (currencyCalc.stripFormat(managedPrice) > 0)
                addonURL += '|' + managedOption.val() + "-1";
            return addonURL;
        }
      };

      function processConfigData(data,defaultPackageId){
        $('#osAddon').val(data.addons.os.id);
        $('#osAddonPrice').val(data.addons.os.addonprice);
        
        generateManagedOptions(data.addons.managed);
        generateTermOptions(data.terms,defaultPackageId);  



        Config.init();
      }

      function generateManagedOptions(managedAddons){
        var optionname = 'managedOption';
        var parentid = '#managedOptions';
        var planaddons = Config.getParameterByName("planaddons").split('|');
        var defaultAddOn = planaddons[0];
        

        $.each(managedAddons, function(i, item) {
          var content='';
          var checked =  item.id == defaultAddOn ? 'checked="checked"' :'';

          content += '<li><input type="radio" name="'+optionname+'"'+ checked +'value="'+item.id+'" data-name="'+item.name+'" data-price="'+item.addonprice+'"> <b>'+ item.name+' -</b><div class="price-container"></div>' +'<ul class="managed-details"><li><b>'+item.os+'</b></li>'+'<li>'+getIncludesText(item) +'</li></ul>';
         
          $(parentid).append(content);
        });
        generateManagementPrices();
      }

      function getIncludesText(managedOption){
        var includes="";
        ##if(activeLanguageAny(en))
            includes =managedOption.includes;
        ##else 
            if($.trim(managedOption.name) == "[@L[cds.sales/gd/pro/dedicated-server-config:Fully-Managed]@L]") 
                  includes= $('#osAddon').val().split('_')[3] == 'linux' 
                                                                  ? "[@L[cds.sales/gd/pro/dedicated-server-config:linuxpromanaged-alt]@L]" 
                                                                  : "[@L[cds.sales/gd/pro/dedicated-server-config:windowspromanagedplus-alt]@L]"
            else
                includes =managedOption.includes; 
        ##endif

        return includes;

      } 

      function generateManagementPrices(){
        $('input:radio[name="managedOption"]').filter(':checked').parent().find('.price-container').append('<span class="orange-text"> [@L[cds.sales/gd/pro/dedicated-server-config:included]@L] </span>');
        var selectedAddonPrice = $('input:radio[name="managedOption"]').filter(':checked').data('price');
        var selectedAddonValue = currencyCalc.stripFormat(selectedAddonPrice);
        $('input:radio[name="managedOption"]').not(':checked').each(function (){
        
          var price = $(this).data('price');
          var addonValue = currencyCalc.stripFormat(price);

          if (parseFloat(addonValue)>parseFloat(selectedAddonValue)){
            $(this).parent().find('.price-container').append(' <span class="orange-text"> [@L[cds.sales/gd/pro/dedicated-server-config:add]@L] '+ currencyCalc.evaluate([price,"-",selectedAddonPrice]) +'</span>');

          }else{
            $(this).parent().find('.price-container').append(' <span class="product-desc"> [@L[cds.sales/gd/pro/dedicated-server-config:subtract]@L] '+ currencyCalc.evaluate([selectedAddonPrice,"-",price]) +'</span>');
          }
        });
      }
      function generateTermOptions(terms,defaultPackageId){
        var optionname= "termOption"
        var parentid = $("#termOptions");
        parentid.empty();
        $.each(terms,function (){
          if(this != '')
            {
                var planItem=this.split('-');
                var monthString =  (planItem[0] > 1) ? "[@L[fosconfigcommon:termmonths]@L]" : "[@L[fosconfigcommon:termmonth]@L]";
                var discount= planItem[2]
                var packageId= planItem[1];
                var price =  planItem[3];            
                var checkedRadiobutton= (defaultPackageId ===  packageId) ?"checked='checked'" : '';
                
            }
            var content='';
            content += '<li><input type="radio" name="'+optionname+'" value="'+packageId+'"  data-term="' +  planItem[0] + '" data-price="'+price+'"'+ '" data-discount="'+discount+'"'+ checkedRadiobutton + '/><span><strong> '+planItem[0] +' '+ monthString + ' - '+' </strong></span><span class="price orange-text"> '+price+' [@L[cds.sales/gd/hosting/vps-hosting-config:mo]@L] </span></li>';
            parentid.append(content);
        });

      }

      function getMappedPlan (plan){
          var month = plan.split('_').pop(0);

          var plan;
          var planaddon;

          if((plan.indexOf("centos") > 0)||(plan.indexOf("ubuntu") > 0)||(plan.indexOf("fedora") > 0)){
                plan= "pro_ds_linux_t1_"+ month+"month";
                planaddon="pro_ds_managed_plus";
          }
          else{
               plan= "pro_ds_windows_t1_"+ month+"month";
                planaddon="pro_ds_managed_plus";          
          }
          window.location.href=  window.location.href.split('?')[0] + "?plan=" + plan + "&planaddons="+planaddon;
      }

      function getPercentage(primaryPrice, secondaryPrice){
        var difference = currencyCalc.evaluate([primaryPrice,"-",secondaryPrice]);
        var division= currencyCalc.stripFormat(difference) / currencyCalc.stripFormat(primaryPrice)
        return parseInt(Math.floor(division * 100));
      }
       function getAddOnDiscount(discountPercent,totalAddonPrice){
        var discountAmount = Math.ceil(currencyCalc.stripFormat(totalAddonPrice)*(1-(discountPercent/100)));
        discountAmount = currencyCalc.evaluate([discountAmount]);
        return discountAmount;
      }

    </script>

    <!-- liveperson includes -->
    <script>
      // defer load liveperson
      $(window).load(function(){
          $('body').append($('<div id="lpButtonDiv"></div>'))
          
          var scriptResource = document.createElement('script');
          scriptResource.src = "[@T[link:<external parammode="explicit" linktype="IMAGEURL" secure="true" path="fos/liveperson/js/liveperson_20150122.min.js"/>]@T]";

          var styleResource = document.createElement('link');
          styleResource.rel = "stylesheet";
          styleResource.type = "text/css";
          styleResource.href = "[@T[link:<external parammode="explicit" linktype="IMAGEURL" secure="true" path="fos/liveperson/css/chat-window_20140205.css"/>]@T]";
          
          var script = document.getElementsByTagName('script')[0];
          script.parentNode.insertBefore(scriptResource, script);
          script.parentNode.insertBefore(styleResource, script);
      });
    </script>

{% endblock %}
