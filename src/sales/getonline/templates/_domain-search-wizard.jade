append vars
  - domainSearch                          = {};
  - domainSearch.tlds                     = ['com','co','org','net'];
  - domainSearch.defaultTld               = 'com';
  - domainSearch.searchNowCallbackFn      = "domainSearchFormSubmit"; /* you need to code a function taking the domain name as a string input */
  - domainSearch.maxDomainLength          = 63;
  - domainSearch.formId                   = "domainAvailableViewForm";
  - domainSearch.title                    = "";
  - domainSearch.cicode                   = "95738";
  - domainSearch.placeholderText          = "Enter your business name or idea.";
  - domainSearch.buttonText               = "[@L[cds.sales/offers/online-business:32573-search]@L]";
  - domainSearch.infoTypeHere             = "[@L[cds.sales/offers/online-business:32573-type-your-business-placeholder]@L]";
  - domainSearch.infoErrorEligibility     = "[@L[cds.sales/offers/online-business:32573-eligibility-error]@L]";
  - domainSearch.infoInvalidTld           = "[@L[cds.sales/offers/online-business:32573-offer-only-valid]@L]";
  - domainSearch.showSearchButton         = true;
  - domainSearch.saveEnteredDomainFn      = "updateSearchedDomain"; /* you need to code a function taking the domain name as a string input */

append pageStyles
  // atlantis:webstash(type="css")
  style.  //SearchEntry
    #domainSearchWizard {
      margin:0 auto; 
      background-color: #77c043;
    }
    
    #domain-available-view,
    #domain-not-available-view {
      padding-top:15px;
    }

    #api-failure,
    #domain-available-view,
    #domain-not-available-view,
    #domain-selected-view {display: none; }


    #domainSearchWizard .domain-name-displayed {
      font-size: 60px;
      text-transform: lowercase; 
      color: #333; 
      background: #fedc45; 
      padding: 0 5px;
      line-height: 1.29em; /* to line up with the button height */
      margin: 0;
      display: inline;
      display: -ms-inline-grid;
    }


    #domainSearchWizard h2.availability-header {
      color: #333333; 
      margin: 20px 0 0; 
      font-size: 40px;
      color: #333; 
    }

    .offer-search-box { padding-bottom:20px;}
    .search-message { display: none; margin-left:20px; margin-top:30px;width:65%;}
    .domain-search-messaging-row {padding-bottom: 40px; display: none;}
    h2.get-a-domain-text {
      margin: 20px 0 5px;
      font-size:24px;
    }

    .domain-search-wizard .domain-icon{height:92px;background: url([@T[link:<imageroot />]@T]fos/sales/themes/scotty/p4p/img/img-domain-icon.png) no-repeat center bottom;}
    .domain-search-wizard .half-hero-left{height:214px;background: url([@T[link:<imageroot />]@T]fos/sales/themes/scotty/p4p/img/img-halfGuy-left.png) no-repeat center bottom;}
    .domain-search-wizard .speach-bubble-left-div {margin-left:5%;width:90%;}
    .domain-search-wizard .speach-bubble-left-white {color: #000;font-family: Tungsten, 'Tungsten A', 'Tungsten B', 'Helvetica Neue', 'Segoe UI', Segoe, Helvetica, Arial, 'Lucida Grande', sans-serif;font-size: 28px;font-size: 2.8rem;
      padding: 10px 20px;text-transform: uppercase;line-height: 1;
      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNy4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSI4MDIuMTMycHgiIGhlaWdodD0iMTUwLjc0MnB4IiB2aWV3Qm94PSIwIDAgODAyLjEzMiAxNTAuNzQyIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA4MDIuMTMyIDE1MC43NDIiDQoJIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGcgaWQ9IkJhY2tncm91bmRfeEEwX0ltYWdlXzFfIj4NCjwvZz4NCjxnIGlkPSJTaGFwZV82XzFfIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3ICAgICI+DQoJPGcgaWQ9IlNoYXBlXzYiPg0KCQk8Zz4NCgkJCTxwb2x5Z29uIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBmaWxsPSIjRkZGRkZGIiBwb2ludHM9Ijc3Ni41NjQsNzMuMjU4IDc1Mi43NjMsMTguMzI4IDYzMC4zNTQsOC44MjEgDQoJCQkJNTcuMDcyLDAuMzcxIDAuMDY2LDg1LjkzNSA3OC43NzQsMTUwLjM3MiA3NDQuMjYyLDE0MS45MjEgNzY0LjY2NCw5NC4zODUgODAyLjA2Niw4NS45MzUgCQkJIi8+DQoJCTwvZz4NCgk8L2c+DQo8L2c+DQo8L3N2Zz4NCg==) no-repeat center center;
      background-size: cover;overflow: visible;}

    /*  speech */

    .speech-shape-upsidedown {
      line-height: 1.9em;
      font-size: 18px;
      padding: 5px 17px;
      color: #fff;
      display: inline-block;
      position: relative;
      margin-bottom: 20px;
      z-index: 2;
    }
    .speech-shape-upsidedown .shape-text {
      position: relative;
      z-index: 40;
    }
    .speech-shape-upsidedown:before {
      content: '';
      position: absolute;
      top: -15px;
      left: 0;
      border-bottom: 15px solid;
      border-right: 15px solid transparent;
    }
    .speech-shape-upsidedown:after {
      content: '';
      position: absolute;
      height: 100%;
      width:20px;
      right: -6px;
      top: 0;
      transform: skew(12deg, 0);
      z-index: 1;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-green {
      background-color: #008a32;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-green:before {
      border-bottom-color: #008a32;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-green:after {
      background-color: #008a32;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-orange {
      background-color: #ef6c0f;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-orange:before {
      border-bottom-color: #ef6c0f;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-orange:after {
      background-color: #ef6c0f;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-white {
      background-color: #fff;
      color: #333;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-white:before {
      border-bottom-color: #fff;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-white:after {
      background-color: #fff;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-yellow {
      background-color: #fedc45;
      color: #333;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-yellow:before {
      border-bottom-color: #fedc45;
    }
    .speech-shape-upsidedown.speech-shape-upsidedown-yellow:after {
      background-color: #fedc45;
    }

    /* (end) speech */

  // atlantis:webstash(type="css")
  style.  // domain-available-view
    #domain-available-view .clickable-show-more {cursor: pointer;}
    #domain-available-view .show-more-arrow { position: relative; top: 12px; margin-left: 5px; width: 0; height: 0; border: 11px solid transparent; border-top-color: #000; content: ''; }
    #domain-available-view button.view-all-button {font-size: 18px; color: #6586C4; font-family: Arial;}

    #available-domain {margin-top: 15px;}
    #available-domain .spin-results-message,
    .spin-results .spin-results-message, 
    .spin-results .spin-result, 
    .spin-template-wrap .spin-template {display:none;}
    #domain-available-view .select-and-continue {margin-bottom: 0px; font-size:20px;text-overflow: ellipsis;}
    #available-domain .spin-results-message,
    .spin-results .spin-results-message {margin-top:15px;}

    #domain-available-view .select-and-continue{margin:10px 0;float:right;}
    #domain-available-view .domain-name-display{margin:14px 0 15px;color:#333;font-size:40px;font-weight:400;display:block;line-height:1}

    #domain-available-view .available-domain-name-row {margin: 5px 0 10px;}
    #domain-available-view h2.available-domain-name-text {margin: 0;}

  // atlantis:webstash(type="css")
  style.  // domain-not-available-view
    #domain-not-available-view .pro-plans .pro-plan-wrap {border-top: 10px solid #008a32; padding: 20px;}
    #domain-not-available-view .pro-plans {margin-top: 0px; }
    
    #domain-not-available-view h4.other-domains-heading-text {padding-top 20px; font-size: 24px; color:#333; font-weight: bold; }
    #domain-not-available-view h6.results-list-heading-text {padding-top 20px; font-size: 18px; color:#333; }
    #domain-not-available-view .domain-spin-wrap {min-height: 120px;border: solid 1px #cccccc;margin-bottom: 15px;} 
    #domain-not-available-view .domain-name-display {text-transform: lowercase; margin-bottom: 0px; margin-top: 0px;}
    #domain-not-available-view .domain-name-display-tld {text-transform: lowercase;margin-bottom: 0px; margin-top: 0px;}
    #domain-not-available-view .clickable-show-more {cursor: pointer;}
    #domain-not-available-view .show-more-arrow { position: relative; top: 12px; margin-left: 5px; width: 0; height: 0; border: 11px solid transparent; border-top-color: #000; content: ''; }

    //- #available-domain .spin-results-message,
    //- .spin-results .spin-results-message, 
    //- .spin-results .spin-result, 
    //- .spin-template-wrap .spin-template {display:none;}
    //- .spin-results .select-and-continue {margin-bottom: 0px; font-size:20px;text-overflow: ellipsis;}
    //- .spin-results .spin-results-message {margin-top:15px;}
    //- .spin-results .checking-availability, #spin-results .now-unavailable {padding-top:5px;}
    //- .spin-results h4.domain-name-display {font-size: 30px; color: #333; font-weight: bold;}
    //- .spin-results h2.domain-name-display-tld {font-size: 40px; color: #333;}
    //- #domain-not-available-view button.view-all-button {font-size: 18px; color: #6586C4; font-family: Arial;}
    //- #spin-results .domain-tile {margin-top: 0px;}

    #domain-not-available-view .not-available-domain-name-row {margin: 35px 0 25px;}

    // Turn off search input message display
    .search-message {display: none; text-transform: none; }

  // atlantis:webstash(type="css")
  style.  // domain-selected-view
    #domain-selected-view .available-domain-name-row {margin: 20px 0 20px;}
    #domain-selected-view h2.available-domain-name-text {margin: 0;}
    #domain-selected-view .reseach-container {padding-top: 10px;}

section#domainSearchWizardSection.green
  .container#domainSearchHeader
    .row
      div.domain-search-wizard.domain-icon(style={'margin-top':'35px'})
    .row
      div.text-center(style={'margin-top':'15px'})
        h2.uppercase(style={'margin-bottom':'0px'}) domain name
    .row
      .col-md-12
        .text-center
          h4.domain-starts.strong(style={'margin-top':'10px'}) It all starts with a domain name that's easy to remember and fits your business. Here's our favorite for <mark class="business-name-display">{0}</mark>

  .container#domainSearchWizard
    #domain-entry-view
      form(id!="#{domainSearch.formId}")
        .row
          .col-md-12
            if(domainSearch.title)
              h2.headline-primary.get-a-domain-text !{domainSearch.title}
        .row
          .col-md-12.offer-search-box
              .input-group
                input.form-control.input-lg.search-form-input.searchInput.helveticafont(type="text" placeholder!="#{domainSearch.placeholderText}" name="domainToCheck" autocomplete="off")
                if(domainSearch.showSearchButton)
                  span.input-group-btn
                    button.btn.btn-primary.btn-lg.offer-search-btn(type="button" name="searchButton" data-ci="#{domainSearch.cicode}") !{domainSearch.buttonText}
        .row.domain-search-messaging-row
          .col-md-12
            span.search-message.headline-primary.speech-shape-upsidedown.speech-shape-upsidedown-yellow.type-your-business-name !{domainSearch.infoTypeHere}
            span.search-message.headline-primary.speech-shape-upsidedown.speech-shape-upsidedown-orange.domain-eligibility-fail !{domainSearch.infoErrorEligibility}
            span.search-message.headline-primary.speech-shape-upsidedown.speech-shape-upsidedown-orange.invalid-TLD-entered !{domainSearch.infoInvalidTld}

  #domain-available-view.js-domain-search-wizard-section
    .container.bg-green-official
      .row#available-domain
        .col-md-9.white
          span.domain-name-display.lowercase.available-domain-name#available-domain-name
        .col-md-3.white
          button.btn.btn-primary.select-and-continue.available-domain-name.uppercase Select
          .spin-results-message.checking-availability [@L[cds.sales/offers/online-business:32573-checking-availability]@L]
          .spin-results-message.now-unavailable [@L[cds.sales/offers/online-business:32573-domain-no-longer-available]@L]

    .container.other-domains.spin-container
      .row
        .col-md-12
          h5(style={'margin-top':'20px'}) <strong>That one not moving you? Here are some alternatives:</strong>
          h6.results-list-heading-text 
            span.spin-counts(data-result-count-template!="[@L[cds.sales/offers/online-business:32573-number-of-number-results]@L]")
            button.btn.btn-link.view-all-button(data-ci="95269") [@L[cds.sales/offers/online-business:32573-view-all-results]@L]
      .spin-results(style={'margin-top':'10px'})
      .spin-template-wrap
        .row.spin-template.spin-result.available-domain-name-row
          .col-md-9.white
            span.domain-name-display.lowercase
          .col-md-3.white
            button.btn.btn-primary.select-and-continue.uppercase Select
            .spin-results-message.checking-availability [@L[cds.sales/offers/online-business:32573-checking-availability]@L]
            .spin-results-message.now-unavailable [@L[cds.sales/offers/online-business:32573-domain-no-longer-available]@L]

      .show-more-section
        h6.text-center(style={'margin-top':'10px'})
          span.clickable-show-more(data-ci="95268") See more
          span.show-more-arrow

  #domain-not-available-view.js-domain-search-wizard-section
    .container
      .row
        .col-md-12
          h2.h0.availability-header.domain-not-available-heading-text [@L[cds.sales/offers/online-business:32573-sorry-domain-unavailable]@L]
      .row.not-available-domain-name-row 
        .col-md-8.col-sm-12
          h2.not-available-domain-name-text.domain-name-displayed.word-break#not-available-domain-name

    .container.other-domains.spin-container
      .row
        .col-md-12
          h6.results-list-heading-text 
            span.spin-counts(data-result-count-template!="[@L[cds.sales/offers/online-business:32573-number-of-number-results]@L]")
            button.btn.btn-link.view-all-button(data-ci="95269") [@L[cds.sales/offers/online-business:32573-view-all-results]@L]
      .spin-results(style={'margin-top':'10px'})
      .spin-template-wrap
        .row.spin-template.spin-result.available-domain-name-row
          .col-md-9.white
            span.domain-name-display.lowercase
          .col-md-3.white
            button.btn.btn-primary.select-and-continue.uppercase Select
            .spin-results-message.checking-availability [@L[cds.sales/offers/online-business:32573-checking-availability]@L]
            .spin-results-message.now-unavailable [@L[cds.sales/offers/online-business:32573-domain-no-longer-available]@L]

      .show-more-section
        h6.text-center(style={'margin-top':'10px'})
          span.clickable-show-more(data-ci="95268") See more
          span.show-more-arrow

  #domain-selected-view.js-domain-search-wizard-section
    .container#selected-domain.bg-green-official
      .row(style={'margin-top':'10px'})
        div.text-center
          h4.strong Congratulations! You have selected the following domain name:
      .row.available-domain-name-row
        div.text-center
          h2.available-domain-name-text.domain-name-displayed.word-break <mark class="selected-domain-name-display"></mark>
      .row(style={'margin-top':'35px'})
        .col-md-2.col-sm-2
        .col-md-4.col-sm-4.get-it-now-btn
          button.btn.btn-purchase.btn-select.uppercase.purchase-btn(data-ci="92733") Get it now
        .col-md-4.col-sm-4
          button#btnSelectedViewSearchAgain.btn.btn-primary.btn-select.btn-search-again.uppercase Search Again
        .col-md-2.col-sm-2

  #api-failure.sf-dialog.api-B-failure
    h2.api-error-header
      img(src!="[@T[link:<imageroot />]@T]fos/sales/themes/montezuma/offers/online-business/WarningSign.png")
      div [@L[cds.sales/offers/online-business:32573-something-unexpected-happened]@L]
    p [@L[cds.sales/offers/online-business:32573-generic-domain-search-error]@L]

  .container#domainSearchFooter.green
    .row
      div(style={'margin-top':'30px'})
        .col-md-9.col-sm-9
          .domain-search-wizard.speach-bubble-left-white
            .domain-search-wizard.speach-bubble-left-div
              h5.uppercase <mark><strong>did you know...</strong></mark>
              h5(style={'margin-top':'10px','text-transform':'none'}) Did you know more than 12 million customers count on GoDaddy to help them find the right domain?  That's roughly the entie population of NYC...and Los Angeles.
        .col-md-3.col-sm-3
          div.domain-search-wizard.half-hero-left

append endOfPageScripts
  script.
    var #{domainSearch.formId} = {
       executeFnByName: function(name, context) {
        
        var args = [] // - original code doesn't work in IE8 [].slice.call(arguments).splice(2);
        for(var i=2; i < arguments.length; i++){
          args.push(arguments[i]);
        }
        var namespaces = name.split(".");
        var func = namespaces.pop();
        for(var i = 0; i < namespaces.length; i++) {
          context = context[namespaces[i]];
        }
        return context[func].apply(this, args);

      },
      validateSubmit: function(e){

        e.preventDefault();
        var domainName = #{domainSearch.formId}.trimmedDomainName(false);
        var functionSaveName = '#{domainSearch.saveEnteredDomainFn}';
        if(functionSaveName.length > 0) {
          #{domainSearch.formId}.executeFnByName(functionSaveName, window, e, domainName);
        }
        if((domainName && domainName.length==0) || !domainName) return false;

        domainName = domainName.toLowerCase();
        domainName = #{domainSearch.formId}.formatDomainWithDefaultTldIfNoneSpecified(domainName);
        if(!#{domainSearch.formId}.ensureValidTld(domainName)) {
          return;
        }
        var functionName = '#{domainSearch.searchNowCallbackFn}';
        if(functionName.length > 0)  {
          #{domainSearch.formId}.executeFnByName(functionName, window, e, domainName);
        }

      },
      trimmedDomainName: function(isKeyPress){
        
        var $form = $("##{domainSearch.formId}"),
          $textInput = $form.find('input[name="domainToCheck"]'),
          domainName = $textInput.val();
        if((domainName && domainName.length==0) || !domainName) return null;

        domainName = #{domainSearch.formId}.reformatDomainToValidLength($textInput, domainName, isKeyPress);
        return domainName;

      },
      reformatDomainToValidLength: function($textInput, domain, isKeyPress){

        var idx = domain.indexOf('.'),
            hasTld = idx > -1,
            sld = hasTld ? domain.substring(0, idx) : domain,
            tld = hasTld ? domain.substring(idx+1) : '',
            needsTrimmed = ((idx == -1) ? domain.length > #{domainSearch.maxDomainLength} : idx > #{domainSearch.maxDomainLength}); /* 63 is the magic number for max length of a domain name */        
        sld = needsTrimmed ? sld.substring(0, #{domainSearch.maxDomainLength}) : sld;
        
        var domainName = sld + ((tld!='') ? '.' + tld : '');
        if(needsTrimmed) {
          $textInput.val(domainName);
        }
        return domainName;

      },
      ensureValidTld: function() {

        var $form = $("##{domainSearch.formId}"),
            $textInput = $form.find('input[name="domainToCheck"]'),
            domainName = $textInput.val(); 
            validTld = #{domainSearch.formId}.hasTldValid(domainName);
        $form.find('.search-message').hide();
        if(validTld) {
          $form.find('.type-your-business-name').show();
        } else {
          $form.find('.invalid-TLD-entered').show();
        }
        return validTld;
        
      },
      hasTldValid: function(domain) {

        domain = $.trim(domain || "");
        var idx = domain.indexOf('.'), isValid = false;
        if(!domain || domain.length == 0 || idx == -1) return true;

        var domainsTld = domain.substring(idx+1).toLowerCase();
        $.each(#{domainSearch.tlds}, function(idx, tld) {
          if(tld.toLowerCase() === domainsTld) {
            isValid = true;
          }
        });
        return isValid;

      },
      formatDomainWithDefaultTldIfNoneSpecified: function(domain) {

        if(domain.indexOf('.') > 0) return domain;
        return domain + '.' + #{domainSearch.defaultTld};

      }
    };

    $(document).ready(function(){

      $("##{domainSearch.formId}").on('click', 'button.offer-search-btn', function(){
        $("##{domainSearch.formId}").submit();
      });

      $("##{domainSearch.formId}").on('submit', #{domainSearch.formId}.validateSubmit);
      $("##{domainSearch.formId}").on('keyup', function(e){ 
        if(e.which == 13) return;
        var domainName = #{domainSearch.formId}.trimmedDomainName(true);
        if(!domainName || domainName.length == 0) return;
        domainName = #{domainSearch.formId}.formatDomainWithDefaultTldIfNoneSpecified(domainName);
        #{domainSearch.formId}.ensureValidTld(domainName);
      });

    });