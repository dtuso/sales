extends ../shared/_config-page

append vars
  - page.title = "[@L[cds.sales/gd/hosting/website-builder:page-title]@L]";
  - page.description = "[@L[cds.sales/gd/hosting/website-builder:meta-description]@L]";
  - page.keywords = "[@L[cds.sales/gd/hosting/website-builder:meta-keywords]@L]"; 
  - page.canonical = "[@T[link:<relative parammode='explicit' path='~/hosting/website-builder.aspx' />]@T]";

  - page.openGraph = page.openGraph || {};
  - page.openGraph.title = "[@L[cds.sales/gd/hosting/website-builder:og-title]@L]";
  - page.openGraph.description = "[@L[cds.sales/gd/hosting/website-builder:og-description]@L]";
  - page.openGraph.image = "[@T[link:<imageroot />]@T]fos/201401/hosting/website-builder/img/og.png";

  - page.links = page.links || {};
  - page.links.canonical = "[@T[link:<relative parammode='explicit' />]@T]";
  - page.links.favicon = "[@T[link:<imageroot />]@T]assets/godaddy.ico";

append pageStyles
  style
    include ./website-builder-config/styles.css 

block header
  p.product-added-to-cart
    span.green-check
    span.product-added-to-cart-text 

block addons
  +configStep({"id":"planStep","flagColor":"blue","flagText":"<span class='step-number bold'>[@L[cds.sales/gd/hosting/website-builder-config:step]@L]</span> | [@L[cds.sales/gd/hosting/website-builder-config:select_plan]@L]"})
    .row
      .step-title [@L[cds.sales/gd/hosting/website-builder-config:plan_title]@L]
    .row
      p.text-secondary.step-subtitle [@L[cds.sales/gd/hosting/website-builder-config:plan_subtitle]@L]
    .row.options-wrapper
      ul#planTypes.product-options

  +configStep({"id":"termStep","flagColor":"orange","flagText":"<span class='step-number bold'>[@L[cds.sales/gd/hosting/website-builder-config:step]@L]</span> | [@L[cds.sales/gd/hosting/website-builder-config:select_term]@L]"})
    .row
      .step-title [@L[cds.sales/gd/hosting/website-builder-config:select_term_title]@L]
    .row
      p.text-secondary.step-subtitle  [@L[cds.sales/gd/hosting/website-builder-config:lock_savings]@L]
    .row.options-wrapper
      ul#termList.product-options

  +configStep({"id":"sslStep","flagColor":"blue","flagText":"<span class='step-number bold'>[@L[cds.sales/gd/hosting/website-builder-config:step]@L]</span> | [@L[cds.sales/gd/hosting/website-builder-config:add_ssl]@L]"})
    .row
      .step-title [@L[cds.sales/gd/hosting/website-builder-config:add_ssl_title]@L]
    .row
      p.text-secondary.step-subtitle  [@L[cds.sales/gd/hosting/website-builder-config:add_ssl_subtitle]@L]
    .row.options-wrapper
      ul#sslList.product-options
  +configStep({"id":"getFoundStep","flagColor":"red","flagText":"<span class='step-number bold'>[@L[cds.sales/gd/hosting/website-builder-config:step]@L]</span> | [@L[cds.sales/gd/hosting/website-builder-config:add_gf]@L]"})
    .row
      .step-title [@L[cds.sales/gd/hosting/website-builder-config:add_gf_title]@L]
    .row
      p.text-secondary.step-subtitle  [@L[cds.sales/gd/hosting/website-builder-config:add_gf_subtitle]@L]
    .row.options-wrapper
      ul#getFoundList.product-options
  +configStepBreak
  #personalCart.hidden_div [@L[cds.sales/gd/hosting/website-builder-config:personal_cart]@L]
  #addedPersonalCart.hidden_div [@L[cds.sales/gd/hosting/website-builder-config:added_personal_cart]@L]
  #addedBusinessPlus.hidden_div [@L[cds.sales/gd/hosting/website-builder-config:added_business_plus_cart]@L]
  #addedBusiness.hidden_div [@L[cds.sales/gd/hosting/website-builder-config:added_business_cart]@L]
  #gfText.hidden_div [@L[cds.sales/gd/hosting/website-builder-config:add_gf]@L]
  | 
  |##if(productIsOffered(99) && !countrySiteAny(mx))
  | 
  #extraRowLeftText.hidden_div [@L[cds.sales/gd/hosting/website-builder-config:free_email]@L]
  #extraRowRightText.hidden_div 
    strike
      | [@T[productprice:<current productid="464069" dropdecimal="false" period="monthly" htmlsymbol="false" negative="parentheses" />]@T]/[@L[cds.sales/_common:mo]@L]
    span.config-text-lead.text-secondary-o
      |   [@T[currencyprice:<price usdamount='0' /> ]@T]
  | 
  |##endif
  | 


block orderSummary
  +configSummary({
    'scroll':'.lastStep'
    })

block disclaimers
  section#disclaimers.disclaimers-section.row
    .col-sm-9
      .col-sm-5
        p.h5
        #disclaimersModal(data-title="[@L[cds.sales/gd/hosting/website-builder:disclaimer-modal-header]@L]",style="display:none")
          p [@L[cds.sales/gd/hosting/website-builder:restristions-apply-tooltip]@L]
          p [@L[cds.sales/gd/hosting/website-builder:modal-disclaimer-5]@L]
      .col-sm-3.col-sm-push-3.buttons
        a.btn.btn-purchase.btn-plan.btn-md.btn-block.btn-continue(id="planConfigContinue",data-ci="85539") [@L[cds.sales/_common:continue]@L]

block domainSearch
  .row
    .col-sm-12 
        h2.get-a-domain-text [@L[cds.sales/hosting/fosconfigcommon:domainheader]@L]
  +configDomainSearchInput({
    'placeholderText': '[@L[cds.sales/_common:search-placeholder]@L]',
    'buttonText': '[@L[cds.sales/_common:search]@L]',
    'linkText': '[@L[cds.sales/_common:dont-want-free-domain]@L]',
    'continueText':'[@L[cds.sales/_common:select-continue]@L]',
    'promoCode': 'wsb-promo',
    'itcCode': 'slp_wst_3',
    'managerItcCode': 'mgr_slp_wst_3',
    'searchCicode': '85541',
    'noDomainCicode': '85548',
    'domainCicode': '85547'
    })


prepend endOfPageScripts
  +breakTemplate()

  +itemTemplate()

  +termTemplate()

  +planTemplate()

  +noThanksAddonTemplate()

  atlantis:webstash(type="js")

    script.
      $.ajaxSetup({cache:false,async:false});
      
      ##if(productIsOffered(99) && !countrySiteAny(mx))
      var plan = (getParameterByName('plan') != '') ? getParameterByName('plan') : "wsb_personal_o365_12month";
      ##else
      var plan = (getParameterByName('plan') != '') ? getParameterByName('plan') : "wsb_personal_12month";
      ##endif
      
      // gs for get started button, ac for add to cart button
      var origin = (getParameterByName('src') != '') ? getParameterByName('src') : "gs";;
      var reload = false;
      var gfSelected = false;
      var sslSelected = false;
      var gfSelected = false;
      var o365Available = false;



      ##if(productIsOffered(104))
      gfAvailable = true;
      ##endif

      ##if(productIsOffered(99) && !countrySiteAny(mx))
      o365Available = true;
      ##endif

      // spoof url for config and packagegrouping removed when both are published
      var url = '[@T[link:<relative path="~/api/package/config/{0}"/>]@T]';
      //url=url + "?configdocid=54ef736af778fc203043be19&groupdocid=54f4ab81f778fc0de4d09b93";
      //url = url + "?configdocid=54ef736af778fc203043be19";

      var plans = [
        {
          name:"Personal",
          text:{
            title:"[@L[cds.sales/gd/hosting/website-builder-config:personal]@L]",
            subtitle:"[@L[cds.sales/gd/hosting/website-builder-config:personal_text]@L]",
            features:"[@L[cds.sales/gd/hosting/website-builder-config:50_themes]@L] | [@L[cds.sales/gd/hosting/website-builder-config:1GB_space]@L]",
            product:"[@L[cds.sales/gd/hosting/website-builder-config:order_personal_wsb]@L]"
          }
        },
          {
          name:"Business",
          text:{
            title:"[@L[cds.sales/gd/hosting/website-builder-config:business]@L]",
            subtitle:"[@L[cds.sales/gd/hosting/website-builder-config:business_text]@L]",
            ##if(productIsOffered(99) && !countrySiteAny(mx))
              features:"[@L[cds.sales/gd/hosting/website-builder-config:300_themes]@L] | [@L[cds.sales/gd/hosting/website-builder-config:mobile_site]@L] ",
            ##else
              features:"[@L[cds.sales/gd/hosting/website-builder-config:300_themes]@L] | [@L[cds.sales/gd/hosting/website-builder-config:mobile_site]@L] | [@L[cds.sales/gd/hosting/website-builder-config:2_email]@L]",
            ##endif
            features:"[@L[cds.sales/gd/hosting/website-builder-config:300_themes]@L] | [@L[cds.sales/gd/hosting/website-builder-config:mobile_site]@L] | [@L[cds.sales/gd/hosting/website-builder-config:2_email]@L]",
            product:"[@L[cds.sales/gd/hosting/website-builder-config:order_business_wsb]@L]"

          }
        },
        {
          name:"Business Plus",
          text:{
            title:"[@L[cds.sales/gd/hosting/website-builder-config:business_plus]@L]",
            subtitle:"[@L[cds.sales/gd/hosting/website-builder-config:business_plus_text]@L]",
            ##if(productIsOffered(99) && !countrySiteAny(mx))
              features:"[@L[cds.sales/gd/hosting/website-builder-config:300_themes]@L] | [@L[cds.sales/gd/hosting/website-builder-config:mobile_site]@L] | [@L[cds.sales/gd/hosting/website-builder-config:seo]@L] | [@L[cds.sales/gd/hosting/website-builder-config:social_manager]@L]",
            ##else
              features:"[@L[cds.sales/gd/hosting/website-builder-config:300_themes]@L] | [@L[cds.sales/gd/hosting/website-builder-config:mobile_site]@L] | [@L[cds.sales/gd/hosting/website-builder-config:5_email]@L] | [@L[cds.sales/gd/hosting/website-builder-config:seo]@L] | [@L[cds.sales/gd/hosting/website-builder-config:social_manager]@L]",
            ##endif
            product:"[@L[cds.sales/gd/hosting/website-builder-config:order_business_plus_wsb]@L]"

          }
        }
      ];

      function getParameterByName(name){
        name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        if(!jQuery.isEmptyObject(results))
          return  decodeURIComponent(results[1].replace(/\+/g, " "));
        else
          return '';
      }

      var Config = {
        init: function(){
          Config.setupPage();
          Config.loadData(plan);
        },
        setupPage: function(){

          var addToCart = 'ac';
          var steps = ['planStep','termStep','sslStep','getFoundStep'];
          
          if (origin === addToCart){
            steps = _.without(steps, 'planStep');
          }
          if(plan.indexOf('wsb_businessplus') >= 0)
          {
            steps = _.without(steps, 'sslStep');
          }
          if(!gfAvailable || plan.indexOf('1month') >= 0){
            steps = _.without(steps, 'getFoundStep');

          }
          Config.setTitle();
          Config.showSteps(steps);
          Config.addStepBreaks();
          Config.stepNumbers();
          $('.config-step:visible:last').addClass('lastStep')
        },
        resetPage: function(){

          var addToCart = 'ac';
          var steps = ['planStep','termStep','sslStep','getFoundStep'];
          
          $('.config-step').hide();
          $('.step-number').html('[@L[cds.sales/gd/hosting/website-builder-config:step]@L]');
          $('.config-step-break').remove();

          if (origin === addToCart){
            steps = _.without(steps, 'planStep');
          }
          if(plan.indexOf('wsb_businessplus') >= 0)
          {
            steps = _.without(steps, 'sslStep');
            $('input:radio[name="sslOption"][value="no_thanks"]').attr('checked',true);
          }
          if(!gfAvailable || plan.indexOf('1month') >= 0){
            steps = _.without(steps, 'getFoundStep');
          }
          Config.setTitle();
          Config.showSteps(steps);
          Config.addStepBreaks();
          Config.stepNumbers();
          $('.lastStep').removeClass('lastStep');

        },
        loadData: function(package){

          var apiUrl = url.replace('{0}',package);

          $.getJSON(apiUrl).success(function (data){
            if(reload){
              Config.resetPage();
            }
            Config.processData(data);
          });
        },
        setTitle: function(){

          var getStarted = 'gs';
          if (origin === getStarted && !reload){
            $('.product-added-to-cart-text').html($('#personalCart').text());
          }
          else{
           if(plan.indexOf('wsb_personal') >= 0){
              $('.product-added-to-cart-text').html($('#addedPersonalCart').text());
            }
            else if(plan.indexOf('wsb_businessplus') >= 0){
              $('.product-added-to-cart-text').html($('#addedBusinessPlus').text());
            }
            else{
              $('.product-added-to-cart-text').html($('#addedBusiness').text());
            }

          }
        },
        showSteps: function(ids){

          $.each(ids, function(key,id){
            $('#'+id).show();
          });

        },
        addStepBreaks: function(){
          var breakTemplate = _.template($( "script.breakTemplate" ).html());

          $('.config-step-break').remove();
          var numberOfSteps = $('.config-step:visible').length - 1;

          $('.config-step:visible').each(function(index){
            if(numberOfSteps != index )
              $(this).parent().append(breakTemplate());
          });
        },
        stepNumbers: function(){

          $('.config-step:visible').each(function(index){
            var numberTokenized = $(this).find('.step-number').html();
            numberTokenized = numberTokenized.replace(/\{0\}/gi, index+1);
            $(this).find('.step-number').html(numberTokenized);
          });
        },
        processData: function(data){

          Config.generateTerms(data.LongerTerms);
          Config.generatePlans(data.PlanListPrices);
          Config.generateGetFound(data.GetFoundPrice);
          Config.generateSSL(data.SSLPrice);

          if(!reload){
            reload = true;
          }

          Config.updateOrderSummary();
        },
        generateTerms: function(terms){
          var radioName= "termOption"
          var parentID = $("#termList");
          var termTemplate = _.template($( "script.termTemplate" ).html());
          
          parentID.empty();

          if(!jQuery.isEmptyObject(terms))
          {
            $.each(terms, function (){
              var termItem = this.split('-');
              var termLength = termItem[0];
              var termPackage= termItem[1];
              var termCurrentMonthlyPrice =  termItem[2];
              var termPercentSavings = termItem[4];
              var termListPrice = termItem[5];
              var termCurrentYearlyPrice =  termItem[6];
              var isSale = ( parseInt(termPercentSavings) > 0 ) ? true : false;
              var monthString =  (termLength > 1) ? "[@L[cds.sales/_common:months]@L]" : "[@L[cds.sales/_common:month]@L]";
              var checkedRadiobutton = ( plan ===  termPackage) ? true : false;
              var isManager = false ; 

              ##if(isManager())
              isManager = true ;
              ##endif

              if(termLength != '48'|| isManager){
                var termData = {
                  radio: radioName,
                  monthly: termCurrentMonthlyPrice,
                  monthlyList: termListPrice,
                  yearly: termCurrentYearlyPrice,
                  package: termPackage,
                  checked: checkedRadiobutton,
                  term: termLength,
                  month: monthString,
                  currentPrice: termCurrentMonthlyPrice,
                  onSale: isSale,
                  listPrice: termListPrice,
                  percentSavings: termPercentSavings
                };
                parentID.append(termTemplate(termData));
              }
            }); 

            $('.radio-'+radioName).click(function(){
              $(this).parent().find('input').trigger('click');
            });

            $('input[name="'+radioName+'"]').click(function(){
              plan = this.defaultValue;
              Config.loadData(plan);
            });
          }
        },
        generatePlans: function(plans){

          var radioName = "planOption";

          var parentID = $("#planTypes");
          var planTemplate = _.template($( "script.planTemplate" ).html());
          
          parentID.empty();

          if(!jQuery.isEmptyObject(plans))
          {
            $.each(plans, function(){
              var planItem = this.split('-');
              var planKey  = planItem[0];
              var planPackage = planItem[1];
              var planCurrentPrice = planItem[2];
              var planListPrice = planItem[3];
              var planPercentSavings = planItem[4];
              var planText = Config.retrievePlanText(planKey);
              var planTitle = planText.title;
              var planProduct = planText.product;
              var planSubtitle = planText.subtitle;
              var planFeatures = planText.features;
              var isSale = ( parseInt(planPercentSavings) > 0 ) ? true : false;
              var isChecked = ( plan ===  planPackage) ? true : false;
              var extraRowLeftText = '';
              var extraRowRightText = '';
              if(o365Available){
                var extraRowLeftText = $('#extraRowLeftText').text();
                var extraRowRightText = $('#extraRowRightText').html();
              }
              

              var planData = {
                radio: radioName,
                package: planPackage,
                plan: planProduct,
                checked: isChecked,
                title: planTitle,
                currentPrice: planCurrentPrice,
                subtitle: planSubtitle,
                onSale: isSale,
                listPrice: planListPrice,
                features: planFeatures,
                percentSavings: planPercentSavings,
                isToolTip: false,
                extraRow: o365Available,
                extraRowLeftText: extraRowLeftText,
                extraRowRightText: extraRowRightText
              };
              parentID.append(planTemplate(planData));

            });

            $('.radio-'+radioName).click(function(){
              $(this).parent().find('input').trigger('click');
            });

            $('input[name="'+radioName+'"]').click(function(){
              plan = this.defaultValue;
              Config.loadData(plan);
            });
          }
        },
        generateSSL: function(ssl){
          var radioName = "sslOption";
          var parentID = $("#sslList");
          var addonTemplate = _.template($( "script.noThanksAddonTemplate" ).html());

          parentID.empty();

          if(!jQuery.isEmptyObject(ssl))
          {
            var sslCurrentYearlyPrice = ssl;
            var monthlyPrice = "[@T[currencyprice:<price usdamount='0' /> ]@T]";
            var sslText = "[@L[cds.sales/gd/hosting/website-builder-config:add_ssl]@L]";
            var termType = "[@L[cds.sales/_common:yr]@L]";
            var sslPackage = "ssl_std_1";
            var checkedRadiobutton = (sslSelected && !(plan.indexOf('wsb_businessplus') >= 0)) ? true : false;

            var sslData = {
              radio: radioName,
              checked:checkedRadiobutton,
              package: sslPackage,
              addon:'[@L[cds.sales/gd/hosting/website-builder-config:order_ssl]@L]',
              monthly: monthlyPrice,
              yearly: sslCurrentYearlyPrice,
              addonText: sslText,
              currentPrice: sslCurrentYearlyPrice,
              termType: termType
            };
            
            parentID.append(addonTemplate(sslData));

            $('.radio-'+radioName).click(function(){
              $(this).parent().parent().parent().parent().find('label').removeClass('uxicon-radio-filled');
              $(this).addClass('uxicon-radio-filled');
              $(this).parent().find('input').attr('checked',true).trigger('click');

            });

            $('input[name="'+radioName+'"]').click(function(){
              Config.updateOrderSummary();
            });

            $('input:radio[name="sslOption"]').click(function(){
              if($('input:radio[name="sslOption"]').filter(':checked').val() != 'no_thanks'){
                sslSelected = true;
              }
              else{
                sslSelected = false;
              }
            });
          }
        },
        generateGetFound: function(gf){
          var radioName = "getFoundOption";
          var parentID = $("#getFoundList");
          var addonTemplate = _.template($( "script.noThanksAddonTemplate" ).html());

          parentID.empty();

          if(!jQuery.isEmptyObject(gf))
          {
            $.each(gf, function (){
              var gfItem = this.split('-');
              var gftermLength = gfItem[0];
              var gfPackage= gfItem[1];
              var gfCurrentMonthlyPrice =  gfItem[2];
              var gfPercentSavings = gfItem[3];
              var gfListPrice = gfItem[4];
              var gfCurrentYearlyPrice =  gfItem[5];
              var gfText = $('#gfText').text();
              var isSale = ( parseInt(gfPercentSavings) > 0 ) ? true : false;
              var termLength = $('input:radio[name="termOption"]').filter(':checked').attr('data-term');
              var termType = "[@L[cds.sales/_common:mo]@L]";
              var selectedGfTerm = ( termLength ===  gftermLength) ? true : false;
              var checkedRadiobutton = (gfSelected && !(plan.indexOf('1month') >= 0)) ? true : false;

              if(selectedGfTerm){
                var gfData = {
                  radio: radioName,
                  checked: checkedRadiobutton,
                  package: gfPackage,
                  addon:'[@L[cds.sales/gd/hosting/website-builder-config:order_gf]@L]',
                  monthly: gfCurrentMonthlyPrice,
                  yearly: gfCurrentYearlyPrice,
                  addonText: gfText,
                  currentPrice: gfCurrentMonthlyPrice,
                  termType: termType
                };
                parentID.append(addonTemplate(gfData));
              }
            });
            
            $('.radio-'+radioName).click(function(){
              $(this).parent().parent().parent().parent().find('label').removeClass('uxicon-radio-filled');
              $(this).addClass('uxicon-radio-filled');
              $(this).parent().find('input').attr('checked',true).trigger('click');

            });
            
            $('input[name="'+radioName+'"]').click(function(){
              Config.updateOrderSummary();
            });
            $('input:radio[name="getFoundOption"]').click(function(){
              if($('input:radio[name="getFoundOption"]').filter(':checked').val() != 'no_thanks'){
                gfSelected = true;
              }
              else{
                gfSelected = false;
              }
            });
          }
        },
        updateOrderSummary: function(){
          
          $('#order-items').empty();

          Config.getSelectedPlan();
          Config.getSelectedSSL();
          Config.getSelectedGF();
          Config.calculateSubTotal();
        },
        getSelectedPlan: function(){

          var parentID = $("#order-items");
          var itemTemplate = _.template($( "script.itemTemplate" ).html());

          var selectedPlan = $('input:radio[name="planOption"]').filter(':checked').attr('data-plan');
          var selectedTerm = $('input:radio[name="termOption"]').filter(':checked').attr('data-term');
          var selectedFactor = Config.getFactor(parseInt(selectedTerm));
          var selectedPricePerTerm = $('input:radio[name="termOption"]').filter(':checked').attr('data-monthly');
          var selectedPricePerYear = $('input:radio[name="termOption"]').filter(':checked').attr('data-yearly');
          var selectedListPricePerTerm = $('input:radio[name="termOption"]').filter(':checked').attr('data-monthlyList');
          var selectedSale = $('input:radio[name="termOption"]').filter(':checked').attr('data-onsale');
          var onSale = (selectedSale == 'true');
          var monthString =  (selectedTerm > 1) ? " [@L[cds.sales/_common:months]@L]" : " [@L[cds.sales/_common:month]@L]";

          if(parseInt(selectedTerm) > 1){
            var selectedTotal = currencyCalc.evaluate([selectedFactor,"*",selectedPricePerYear]);
          }
          else{
            var selectedTotal = currencyCalc.evaluate([selectedTerm,"*",selectedPricePerTerm]);
          }

          var selectedListTotal = currencyCalc.evaluate([selectedTerm,"*",selectedListPricePerTerm]);
          var selectedSavings = currencyCalc.evaluate([selectedListTotal,"-",selectedTotal]);

          var itemData = {
                itemName: selectedPlan,
                itemTerm: selectedTerm + monthString,
                itemPricePerTerm: selectedPricePerTerm + "/[@L[cds.sales/_common:mo]@L]",
                itemTotal: selectedTotal,
                onSale: onSale,
                itemsSavings: selectedSavings,
                itemID: 'selectedPlan'

              };
          parentID.append(itemTemplate(itemData));

          ##if(productIsOffered(99) && !countrySiteAny(mx))
            var o365Data = {
                itemName: '[@L[cds.sales/gd/hosting/website-builder-config:starter_email]@L]',
                itemTerm: '12' + monthString,
                itemPricePerTerm: '[@T[currencyprice:<price usdamount='0' /> ]@T]' + "/[@L[cds.sales/_common:mo]@L]",
                itemTotal: '[@T[currencyprice:<price usdamount='0' /> ]@T]',
                onSale: false,
                itemsSavings: '0',
                itemID: 'o365PlanSelected'

              };
            parentID.append(itemTemplate(o365Data));

          ##endif


        },
        getSelectedSSL: function(){

          var parentID = $("#order-items");
          var itemTemplate = _.template($( "script.itemTemplate" ).html());

          var selectedValue = $('input:radio[name="sslOption"]').filter(':checked').val();

          if (selectedValue != 'no_thanks'){

            var selectedAddon = $('input:radio[name="sslOption"]').filter(':checked').attr('data-addon');
            var selectedTerm = '1';
            var selectedPricePerTerm = $('input:radio[name="sslOption"]').filter(':checked').attr('data-yearly');
            var onSale = false;


            var itemData = {
                  itemName: selectedAddon,
                  itemTerm: selectedTerm + ' [@L[cds.sales/_common:year]@L]',
                  itemPricePerTerm: selectedPricePerTerm + "/[@L[cds.sales/_common:yr]@L]",
                  itemTotal: selectedPricePerTerm,
                  onSale: onSale,
                  itemID: 'selectedSSL'

                };

            parentID.append(itemTemplate(itemData));
          }
        },
        getSelectedGF: function(){

          var parentID = $("#order-items");
          var itemTemplate = _.template($( "script.itemTemplate" ).html());

          var selectedValue = $('input:radio[name="getFoundOption"]').filter(':checked').val();

          if (selectedValue != 'no_thanks'){

            var selectedAddon = $('input:radio[name="getFoundOption"]').filter(':checked').attr('data-addon');
            var selectedTerm = $('input:radio[name="termOption"]').filter(':checked').attr('data-term');
            var selectedFactor = Config.getFactor(parseInt(selectedTerm));
            var selectedPricePerTerm = $('input:radio[name="getFoundOption"]').filter(':checked').attr('data-monthly');
            var selectedPricePerYear = $('input:radio[name="getFoundOption"]').filter(':checked').attr('data-yearly');
            var onSale = false;
            var monthString =  (selectedTerm > 1) ? " [@L[cds.sales/_common:months]@L]" : " [@L[cds.sales/_common:month]@L]";

            if(parseInt(selectedTerm) > 1){
              var selectedTotal = currencyCalc.evaluate([selectedFactor,"*",selectedPricePerYear]);
            }
            else{
              var selectedTotal = currencyCalc.evaluate([selectedTerm,"*",selectedPricePerTerm]);
            }


            var itemData = {
                  itemName: selectedAddon,
                  itemTerm: selectedTerm + monthString,
                  itemPricePerTerm: selectedPricePerTerm + "/[@L[cds.sales/_common:mo]@L]",
                  itemTotal: selectedTotal,
                  onSale: onSale,
                  itemID: 'selectedGF'

                };
            parentID.append(itemTemplate(itemData));
          }
        },
        calculateSubTotal: function(){
          var subTotal = '0';
          var savingsTotal = '0';

          $('.item-total-price').each(function(){
            subTotal = currencyCalc.evaluate([subTotal,"+",$(this).text()]);
          });

          $('.order-total').html(subTotal);

          $('.item-savings').each(function(){
            savingsTotal = currencyCalc.evaluate([savingsTotal,"+",$(this).text()]);
          });
          
          if(savingsTotal == '0' ){
            $('.savings-total-wrapper').hide();
          }
          else{
            $('.savings-total-wrapper').show();
            $('.savings-total').html(savingsTotal);
          }
        },
        addPlanToCart:function(){
          var itc;
          ##if(isManager())
            itc="mgr_slp_wst_3";
          ##else
            itc="slp_wst_3";
          ##endif
          
          var cartAPIUrl = Config.getCartAPIUrl('update',itc,'83980',1, plan);

          $.getJSON(cartAPIUrl, function (data) {
            if (data.Success == true) { 
              if($('input:radio[name="sslOption"]').filter(':checked').val() != 'no_thanks'){
                Config.addAddonToCart('sslOption');
              }
              if($('input:radio[name="getFoundOption"]').filter(':checked').val() != 'no_thanks'){
                Config.addAddonToCart('getFoundOption');
              }
              var selectedTerm = $('input:radio[name="termOption"]').filter(':checked').attr('data-term');
              if(parseInt(selectedTerm) == 1){
                ##if(isManager())
                  window.location = '[@T[link:<external linktype="MANAGERCARTURL" path="/basket.aspx" secure="true"  />]@T]';
                ##else
                  window.location = '[@T[link:<external linktype="carturl" path="/basket.aspx" secure="true" />]@T]';
                ##endif
              }
            }
            });
        },
        addAddonToCart: function(addonOption){
          var itc;
          ##if(isManager())
            itc="mgr_slp_wst_3";
          ##else
            itc="slp_wst_3";
          ##endif
          var addon = $('input:radio[name="'+addonOption+'"]').filter(':checked').val();
          var cartAPIUrl = Config.getCartAPIUrl('update',itc,'83981',1, addon);

          $.getJSON(cartAPIUrl, function (data) {
          });
        },
        getCartAPIUrl: function(action,itcCode,ciCode,quantity,planSelected) {
          var cartUrl = '[@T[link:<relative path="/api/package/{0}/{1}/{2}/{3}/{4}"/>]@T]';
            cartUrl = cartUrl.replace('{0}',action).replace('{1}',itcCode).replace('{2}',ciCode).replace('{3}',quantity).replace('{4}',planSelected);
            return cartUrl;
        },
        retrievePlanText: function(planKey){
          var text =''; 
          $.each(plans, function(){
            if(this.name == planKey){
              text = this.text;
            }
          });
          return text;
        },
        getFactor: function(term){
          var factor;
          switch(term) {
            case 24:
                factor = 2;
                break;
            case 36:
                factor = 3;
                break;
            case 48:
                factor = 4;
                break;
            case 60:
                factor = 5;
                break              
            default:
                factor = 1;
            }
          return factor;
        }
      };
      
      Config.init();

      $(document).ready(function(){
        $('.btn-continue').click(function(){
          Config.addPlanToCart();
          var selectedTerm = $('input:radio[name="termOption"]').filter(':checked').attr('data-term');
          if(parseInt(selectedTerm) > 1){
            $('.configuration-container').hide();
            $('.domain-search-container').show();
            $("html, body").animate({ scrollTop: 0 }, 0);
          }
        });


      });
